<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Seata 部署指南 | 花发故年枝 - qlan's blog</title><meta name=keywords content><meta name=description content="环境 Docker - 1.13.1 docker-compose - 1.23.2 seata-server - 1.4.2 Nacos - 2.0.4 步骤 新建seata目录 1 2 mkdir /opt/seata mkdir /opt/seata/config 新建seata服务端配置文件registry.conf 1 vi /opt/seata/config/registry.conf 编写以下配置
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 registry { type = &#34;nacos&#34; nacos { # 服务名称 application = &#34;seata-server&#34; serverAddr = &#34;127.0.0.1:18848&#34; # 命名空间ID namespace = &#34;&#34; group = &#34;SEATA_GROUP&#34; # 集群名称 cluster = &#34;default&#34; } } config { type = &#34;nacos&#34; nacos { serverAddr = &#34;127."><meta name=author content="谦兰君"><link rel=canonical href=https://qlan.cc/post/seata%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/><link crossorigin=anonymous href=/assets/css/stylesheet.e534de95c45f12e712642d4891fdc622837d0270dd58b129282e0e4b65b5df1a.css integrity rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js integrity onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://qlan.cc/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://qlan.cc/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://qlan.cc/favicon-32x32.png><link rel=apple-touch-icon href=https://qlan.cc/apple-touch-icon.png><link rel=mask-icon href=https://qlan.cc/site.webmanifest><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-123-45','auto'),ga('send','pageview'))</script><meta property="og:title" content="Seata 部署指南"><meta property="og:description" content="环境 Docker - 1.13.1 docker-compose - 1.23.2 seata-server - 1.4.2 Nacos - 2.0.4 步骤 新建seata目录 1 2 mkdir /opt/seata mkdir /opt/seata/config 新建seata服务端配置文件registry.conf 1 vi /opt/seata/config/registry.conf 编写以下配置
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 registry { type = &#34;nacos&#34; nacos { # 服务名称 application = &#34;seata-server&#34; serverAddr = &#34;127.0.0.1:18848&#34; # 命名空间ID namespace = &#34;&#34; group = &#34;SEATA_GROUP&#34; # 集群名称 cluster = &#34;default&#34; } } config { type = &#34;nacos&#34; nacos { serverAddr = &#34;127."><meta property="og:type" content="article"><meta property="og:url" content="https://qlan.cc/post/seata%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/"><meta property="og:image" content="https://qlan.cc/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-06-04T18:25:11+08:00"><meta property="article:modified_time" content="2022-06-04T18:25:11+08:00"><meta property="og:site_name" content="花发故年枝"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://qlan.cc/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Seata 部署指南"><meta name=twitter:description content="环境 Docker - 1.13.1 docker-compose - 1.23.2 seata-server - 1.4.2 Nacos - 2.0.4 步骤 新建seata目录 1 2 mkdir /opt/seata mkdir /opt/seata/config 新建seata服务端配置文件registry.conf 1 vi /opt/seata/config/registry.conf 编写以下配置
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 registry { type = &#34;nacos&#34; nacos { # 服务名称 application = &#34;seata-server&#34; serverAddr = &#34;127.0.0.1:18848&#34; # 命名空间ID namespace = &#34;&#34; group = &#34;SEATA_GROUP&#34; # 集群名称 cluster = &#34;default&#34; } } config { type = &#34;nacos&#34; nacos { serverAddr = &#34;127."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://qlan.cc/post/"},{"@type":"ListItem","position":2,"name":"Seata 部署指南","item":"https://qlan.cc/post/seata%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Seata 部署指南","name":"Seata 部署指南","description":"环境 Docker - 1.13.1 docker-compose - 1.23.2 seata-server - 1.4.2 Nacos - 2.0.4 步骤 新建seata目录 1 2 mkdir /opt/seata mkdir /opt/seata/config 新建seata服务端配置文件registry.conf 1 vi /opt/seata/config/registry.conf 编写以下配置\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 registry { type = \u0026#34;nacos\u0026#34; nacos { # 服务名称 application = \u0026#34;seata-server\u0026#34; serverAddr = \u0026#34;127.0.0.1:18848\u0026#34; # 命名空间ID namespace = \u0026#34;\u0026#34; group = \u0026#34;SEATA_GROUP\u0026#34; # 集群名称 cluster = \u0026#34;default\u0026#34; } } config { type = \u0026#34;nacos\u0026#34; nacos { serverAddr = \u0026#34;127.","keywords":[],"articleBody":"环境 Docker - 1.13.1 docker-compose - 1.23.2 seata-server - 1.4.2 Nacos - 2.0.4 步骤 新建seata目录 1 2 mkdir /opt/seata mkdir /opt/seata/config 新建seata服务端配置文件registry.conf 1 vi /opt/seata/config/registry.conf 编写以下配置\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 registry { type = \"nacos\" nacos { # 服务名称 application = \"seata-server\" serverAddr = \"127.0.0.1:18848\" # 命名空间ID namespace = \"\" group = \"SEATA_GROUP\" # 集群名称 cluster = \"default\" } } config { type = \"nacos\" nacos { serverAddr = \"127.0.0.1:18848\" namespace = \"\" group = \"SEATA_GROUP\" # 配置文件dataId dataId = \"seata-server.properties\" } } 在nacos新建seata-server.properties配置 注意配置文件的Group要与上一步配置的一致\n1 2 3 4 5 6 7 store.mode=db store.db.datasource=druid store.db.dbType=mysql store.db.driverClassName=com.mysql.cj.jdbc.Driver store.db.url=jdbc:mysql://192.168.1.213:3309/seata-server?useUnicode=true\u0026characterEncoding=utf8\u0026connectTimeout=1000\u0026socketTimeout=3000\u0026autoReconnect=true\u0026useSSL=false store.db.user=root store.db.password=123456 初始化数据库 新建上一步配置的数据库seata-server，执行seata-server.sql\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 -- -------------------------------- The script used when storeMode is 'db' -------------------------------- -- the table to store GlobalSession data CREATE TABLE IF NOT EXISTS `global_table` ( `xid` VARCHAR(128) NOT NULL, `transaction_id` BIGINT, `status` TINYINT NOT NULL, `application_id` VARCHAR(32), `transaction_service_group` VARCHAR(32), `transaction_name` VARCHAR(128), `timeout` INT, `begin_time` BIGINT, `application_data` VARCHAR(2000), `gmt_create` DATETIME, `gmt_modified` DATETIME, PRIMARY KEY (`xid`), KEY `idx_status_gmt_modified` (`status` , `gmt_modified`), KEY `idx_transaction_id` (`transaction_id`) ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4; -- the table to store BranchSession data CREATE TABLE IF NOT EXISTS `branch_table` ( `branch_id` BIGINT NOT NULL, `xid` VARCHAR(128) NOT NULL, `transaction_id` BIGINT, `resource_group_id` VARCHAR(32), `resource_id` VARCHAR(256), `branch_type` VARCHAR(8), `status` TINYINT, `client_id` VARCHAR(64), `application_data` VARCHAR(2000), `gmt_create` DATETIME(6), `gmt_modified` DATETIME(6), PRIMARY KEY (`branch_id`), KEY `idx_xid` (`xid`) ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4; -- the table to store lock data CREATE TABLE IF NOT EXISTS `lock_table` ( `row_key` VARCHAR(128) NOT NULL, `xid` VARCHAR(128), `transaction_id` BIGINT, `branch_id` BIGINT NOT NULL, `resource_id` VARCHAR(256), `table_name` VARCHAR(32), `pk` VARCHAR(36), `status` TINYINT NOT NULL DEFAULT '0' COMMENT '0:locked ,1:rollbacking', `gmt_create` DATETIME, `gmt_modified` DATETIME, PRIMARY KEY (`row_key`), KEY `idx_status` (`status`), KEY `idx_branch_id` (`branch_id`), KEY `idx_xid_and_branch_id` (`xid` , `branch_id`) ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4; CREATE TABLE IF NOT EXISTS `distributed_lock` ( `lock_key` CHAR(20) NOT NULL, `lock_value` VARCHAR(20) NOT NULL, `expire` BIGINT, primary key (`lock_key`) ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4; INSERT INTO `distributed_lock` (lock_key, lock_value, expire) VALUES ('AsyncCommitting', ' ', 0); INSERT INTO `distributed_lock` (lock_key, lock_value, expire) VALUES ('RetryCommitting', ' ', 0); INSERT INTO `distributed_lock` (lock_key, lock_value, expire) VALUES ('RetryRollbacking', ' ', 0); INSERT INTO `distributed_lock` (lock_key, lock_value, expire) VALUES ('TxTimeoutCheck', ' ', 0); 编写docker-compose.yaml 1 vi /opt/seata/docker-compose.yaml 编写以下配置\n1 2 3 4 5 6 7 8 9 10 11 12 13 version: \"3.1\" services: alum-seata: image: seataio/seata-server:1.4.2 hostname: alum-seata ports: - \"18091:18091\" environment: - SEATA_PORT=18091 - SEATA_IP=127.0.0.1 - SEATA_CONFIG_NAME=file:/root/seata-config/registry volumes: - \"/opt/seata/config:/root/seata-config\" 启动seata-server 1 2 cd /opt/seata/ docker-compose up -d 客户端配置 新建seata-client配置 1 2 3 4 5 6 seata.tx-service-group=sfc_tx_group seata.service.vgroup-mapping.sfc_tx_group=default seata.registry.type=nacos seata.registry.nacos.server-addr=127.0.0.1:18848 seata.registry.nacos.application=seata-server seata.registry.nacos.group=SEATA_GROUP 数据新建undo_log表，执行undo_log.sql 1 2 3 4 5 6 7 8 9 10 11 12 13 14 -- 注意此处0.3.0+ 增加唯一索引 ux_undo_log CREATE TABLE `undo_log` ( `id` bigint(20) NOT NULL AUTO_INCREMENT, `branch_id` bigint(20) NOT NULL, `xid` varchar(100) NOT NULL, `context` varchar(128) NOT NULL, `rollback_info` longblob NOT NULL, `log_status` int(11) NOT NULL, `log_created` datetime NOT NULL, `log_modified` datetime NOT NULL, `ext` varchar(100) DEFAULT NULL, PRIMARY KEY (`id`), UNIQUE KEY `ux_undo_log` (`xid`,`branch_id`) ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8; ","wordCount":"591","inLanguage":"en","datePublished":"2022-06-04T18:25:11+08:00","dateModified":"2022-06-04T18:25:11+08:00","author":{"@type":"Person","name":"谦兰君"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://qlan.cc/post/seata%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/"},"publisher":{"@type":"Organization","name":"花发故年枝 - qlan's blog","logo":{"@type":"ImageObject","url":"https://qlan.cc/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><header class=header><nav class=nav><div class=logo><a href=https://qlan.cc/ accesskey=h title="花发故年枝 (Alt + H)"><img src=https://qlan.cc/apple-touch-icon.png alt=logo aria-label=logo height=35>花发故年枝</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://qlan.cc/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://qlan.cc/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://qlan.cc/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://qlan.cc/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Seata 部署指南<sup><span class=entry-isdraft>&nbsp;&nbsp;[draft]</span></sup></h1><div class=post-meta><span title='2022-06-04 18:25:11 +0800 CST'>June 4, 2022</span>&nbsp;·&nbsp;谦兰君</div></header><div class=post-content><h2 id=环境>环境<a hidden class=anchor aria-hidden=true href=#环境>#</a></h2><ul><li>Docker - 1.13.1</li><li>docker-compose - 1.23.2</li><li>seata-server - 1.4.2</li><li>Nacos - 2.0.4</li></ul><h2 id=步骤>步骤<a hidden class=anchor aria-hidden=true href=#步骤>#</a></h2><ol><li>新建seata目录</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>mkdir /opt/seata
</span></span><span class=line><span class=cl>mkdir /opt/seata/config
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>新建seata服务端配置文件<code>registry.conf</code></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>vi /opt/seata/config/registry.conf
</span></span></code></pre></td></tr></table></div></div><p>编写以下配置</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>registry {
</span></span><span class=line><span class=cl>  type = &#34;nacos&#34;
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  nacos {
</span></span><span class=line><span class=cl>    # 服务名称
</span></span><span class=line><span class=cl>    application = &#34;seata-server&#34;
</span></span><span class=line><span class=cl>    serverAddr = &#34;127.0.0.1:18848&#34;
</span></span><span class=line><span class=cl>    # 命名空间ID
</span></span><span class=line><span class=cl>    namespace = &#34;&#34;
</span></span><span class=line><span class=cl>    group = &#34;SEATA_GROUP&#34;
</span></span><span class=line><span class=cl>    # 集群名称
</span></span><span class=line><span class=cl>    cluster = &#34;default&#34;
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>config {
</span></span><span class=line><span class=cl>  type = &#34;nacos&#34;
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  nacos {
</span></span><span class=line><span class=cl>    serverAddr = &#34;127.0.0.1:18848&#34;
</span></span><span class=line><span class=cl>    namespace = &#34;&#34;
</span></span><span class=line><span class=cl>    group = &#34;SEATA_GROUP&#34;
</span></span><span class=line><span class=cl>    # 配置文件dataId
</span></span><span class=line><span class=cl>    dataId = &#34;seata-server.properties&#34;
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><ol start=3><li>在nacos新建<code>seata-server.properties</code>配置</li></ol><blockquote><p>注意配置文件的Group要与上一步配置的一致</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>store.mode=db
</span></span><span class=line><span class=cl>store.db.datasource=druid
</span></span><span class=line><span class=cl>store.db.dbType=mysql
</span></span><span class=line><span class=cl>store.db.driverClassName=com.mysql.cj.jdbc.Driver
</span></span><span class=line><span class=cl>store.db.url=jdbc:mysql://192.168.1.213:3309/seata-server?useUnicode=true&amp;characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useSSL=false
</span></span><span class=line><span class=cl>store.db.user=root
</span></span><span class=line><span class=cl>store.db.password=123456
</span></span></code></pre></td></tr></table></div></div><ol start=4><li>初始化数据库</li></ol><p>新建上一步配置的数据库<code>seata-server</code>，执行<code>seata-server.sql</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- -------------------------------- The script used when storeMode is &#39;db&#39; --------------------------------
</span></span></span><span class=line><span class=cl><span class=c1>-- the table to store GlobalSession data
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=o>`</span><span class=n>global_table</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>xid</span><span class=o>`</span><span class=w>                       </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>128</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>transaction_id</span><span class=o>`</span><span class=w>            </span><span class=nb>BIGINT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>status</span><span class=o>`</span><span class=w>                    </span><span class=n>TINYINT</span><span class=w>      </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>application_id</span><span class=o>`</span><span class=w>            </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>32</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>transaction_service_group</span><span class=o>`</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>32</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>transaction_name</span><span class=o>`</span><span class=w>          </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>128</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>timeout</span><span class=o>`</span><span class=w>                   </span><span class=nb>INT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>begin_time</span><span class=o>`</span><span class=w>                </span><span class=nb>BIGINT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>application_data</span><span class=o>`</span><span class=w>          </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>2000</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>gmt_create</span><span class=o>`</span><span class=w>                </span><span class=n>DATETIME</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>gmt_modified</span><span class=o>`</span><span class=w>              </span><span class=n>DATETIME</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>xid</span><span class=o>`</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>KEY</span><span class=w> </span><span class=o>`</span><span class=n>idx_status_gmt_modified</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>status</span><span class=o>`</span><span class=w> </span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>gmt_modified</span><span class=o>`</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>KEY</span><span class=w> </span><span class=o>`</span><span class=n>idx_transaction_id</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>transaction_id</span><span class=o>`</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>InnoDB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>utf8mb4</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- the table to store BranchSession data
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=o>`</span><span class=n>branch_table</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>branch_id</span><span class=o>`</span><span class=w>         </span><span class=nb>BIGINT</span><span class=w>       </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>xid</span><span class=o>`</span><span class=w>               </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>128</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>transaction_id</span><span class=o>`</span><span class=w>    </span><span class=nb>BIGINT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>resource_group_id</span><span class=o>`</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>32</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>resource_id</span><span class=o>`</span><span class=w>       </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>256</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>branch_type</span><span class=o>`</span><span class=w>       </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>8</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>status</span><span class=o>`</span><span class=w>            </span><span class=n>TINYINT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>client_id</span><span class=o>`</span><span class=w>         </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>64</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>application_data</span><span class=o>`</span><span class=w>  </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>2000</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>gmt_create</span><span class=o>`</span><span class=w>        </span><span class=n>DATETIME</span><span class=p>(</span><span class=mi>6</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>gmt_modified</span><span class=o>`</span><span class=w>      </span><span class=n>DATETIME</span><span class=p>(</span><span class=mi>6</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>branch_id</span><span class=o>`</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>KEY</span><span class=w> </span><span class=o>`</span><span class=n>idx_xid</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>xid</span><span class=o>`</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>InnoDB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>utf8mb4</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- the table to store lock data
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=o>`</span><span class=n>lock_table</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>row_key</span><span class=o>`</span><span class=w>        </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>128</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>xid</span><span class=o>`</span><span class=w>            </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>128</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>transaction_id</span><span class=o>`</span><span class=w> </span><span class=nb>BIGINT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>branch_id</span><span class=o>`</span><span class=w>      </span><span class=nb>BIGINT</span><span class=w>       </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>resource_id</span><span class=o>`</span><span class=w>    </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>256</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=k>table_name</span><span class=o>`</span><span class=w>     </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>32</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>pk</span><span class=o>`</span><span class=w>             </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>36</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>status</span><span class=o>`</span><span class=w>         </span><span class=n>TINYINT</span><span class=w>      </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;0:locked ,1:rollbacking&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>gmt_create</span><span class=o>`</span><span class=w>     </span><span class=n>DATETIME</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>gmt_modified</span><span class=o>`</span><span class=w>   </span><span class=n>DATETIME</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>row_key</span><span class=o>`</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>KEY</span><span class=w> </span><span class=o>`</span><span class=n>idx_status</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>status</span><span class=o>`</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>KEY</span><span class=w> </span><span class=o>`</span><span class=n>idx_branch_id</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>branch_id</span><span class=o>`</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>KEY</span><span class=w> </span><span class=o>`</span><span class=n>idx_xid_and_branch_id</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>xid</span><span class=o>`</span><span class=w> </span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>branch_id</span><span class=o>`</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>InnoDB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>utf8mb4</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=o>`</span><span class=n>distributed_lock</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>lock_key</span><span class=o>`</span><span class=w>       </span><span class=nb>CHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>lock_value</span><span class=o>`</span><span class=w>     </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>expire</span><span class=o>`</span><span class=w>         </span><span class=nb>BIGINT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>lock_key</span><span class=o>`</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>InnoDB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>utf8mb4</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>distributed_lock</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=n>lock_key</span><span class=p>,</span><span class=w> </span><span class=n>lock_value</span><span class=p>,</span><span class=w> </span><span class=n>expire</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;AsyncCommitting&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39; &#39;</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>distributed_lock</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=n>lock_key</span><span class=p>,</span><span class=w> </span><span class=n>lock_value</span><span class=p>,</span><span class=w> </span><span class=n>expire</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;RetryCommitting&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39; &#39;</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>distributed_lock</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=n>lock_key</span><span class=p>,</span><span class=w> </span><span class=n>lock_value</span><span class=p>,</span><span class=w> </span><span class=n>expire</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;RetryRollbacking&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39; &#39;</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>distributed_lock</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=n>lock_key</span><span class=p>,</span><span class=w> </span><span class=n>lock_value</span><span class=p>,</span><span class=w> </span><span class=n>expire</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;TxTimeoutCheck&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39; &#39;</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol start=5><li>编写<code>docker-compose.yaml</code></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>vi /opt/seata/docker-compose.yaml
</span></span></code></pre></td></tr></table></div></div><p>编写以下配置</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3.1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>alum-seata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>seataio/seata-server:1.4.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>alum-seata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;18091:18091&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>SEATA_PORT=18091</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>SEATA_IP=127.0.0.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>SEATA_CONFIG_NAME=file:/root/seata-config/registry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;/opt/seata/config:/root/seata-config&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol start=6><li>启动seata-server</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>cd</span> /opt/seata/
</span></span><span class=line><span class=cl>docker-compose up -d
</span></span></code></pre></td></tr></table></div></div><h2 id=客户端配置>客户端配置<a hidden class=anchor aria-hidden=true href=#客户端配置>#</a></h2><ol><li>新建seata-client配置</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>seata.tx-service-group=sfc_tx_group
</span></span><span class=line><span class=cl>seata.service.vgroup-mapping.sfc_tx_group=default
</span></span><span class=line><span class=cl>seata.registry.type=nacos
</span></span><span class=line><span class=cl>seata.registry.nacos.server-addr=127.0.0.1:18848
</span></span><span class=line><span class=cl>seata.registry.nacos.application=seata-server
</span></span><span class=line><span class=cl>seata.registry.nacos.group=SEATA_GROUP
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>数据新建undo_log表，执行<code>undo_log.sql</code></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 注意此处0.3.0+ 增加唯一索引 ux_undo_log
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=n>undo_log</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=w> </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>branch_id</span><span class=o>`</span><span class=w> </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>xid</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>context</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>128</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>rollback_info</span><span class=o>`</span><span class=w> </span><span class=n>longblob</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>log_status</span><span class=o>`</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>log_created</span><span class=o>`</span><span class=w> </span><span class=n>datetime</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>log_modified</span><span class=o>`</span><span class=w> </span><span class=n>datetime</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>ext</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>UNIQUE</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=o>`</span><span class=n>ux_undo_log</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>xid</span><span class=o>`</span><span class=p>,</span><span class=o>`</span><span class=n>branch_id</span><span class=o>`</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=o>=</span><span class=n>utf8</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2018-2022 <a href=https://qlan.cc/>QLAN.CC</a></span>
<span>💕</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement('button');e.classList.add('copy-code'),e.innerHTML='copy';function s(){e.innerHTML='copied!',setTimeout(()=>{e.innerHTML='copy'},2e3)}e.addEventListener('click',o=>{if('clipboard'in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand('copy'),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>